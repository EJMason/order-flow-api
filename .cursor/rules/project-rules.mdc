---
description: Project conventions for interview-order-api
globs: ["src/**/*.ts", "scripts/**/*.ts"]
---

# Module System
- ESM only (import/export)
- Use `.js` extension in imports even for `.ts` files (Node ESM resolution)

# Dependency Injection
Factory function pattern with Awilix:
```typescript
export function createSomeService({ dependency }: Dependencies) {
  async function doThing() {
    // implementation
  }

  return { doThing };
}

export type SomeService = ReturnType<typeof createSomeService>;
```

Do NOT use classes. Do NOT use default exports for services.

# Folder Structure
Organize by feature:
```
src/
├── [feature]/
│   ├── [feature]Routes.ts
│   ├── [feature]Service.ts
│   ├── [feature]Repository.ts
│   └── [feature]Schemas.ts
├── shared/
├── container.ts
├── app.ts
└── server.ts
```

# Database
- Use `postgres` package (porsager)
- Tagged templates: sql`SELECT * FROM x WHERE id = ${id}`
- All DB access through repository functions

# Naming
- Files: camelCase
- Functions: camelCase
- Types: PascalCase
- Constants: SCREAMING_SNAKE_CASE

# Validation (Zod v4)
This project uses Zod v4. Use top-level format validators instead of method chains:
```typescript
// ✅ Correct (Zod v4)
z.email()
z.url()
z.uuid()

// ❌ Deprecated
z.string().email()
z.string().url()
z.string().uuid()
```

For nullable/optional emails: `z.email().nullable().optional()`

# Documentation Lookup
Always use Context7 MCP (`resolve-library-id` then `query-docs`) when you have questions about package APIs or need to verify current syntax.
